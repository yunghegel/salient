package org.yunghegel.salient.engine.input

import com.badlogic.gdx.Input
import com.badlogic.gdx.InputAdapter
import com.badlogic.gdx.InputMultiplexer
import com.badlogic.gdx.InputProcessor
import com.badlogic.gdx.utils.SnapshotArray
import ktx.collections.removeAll
import ktx.inject.Context
import org.yunghegel.gdx.utils.ext.toGdxArray
import org.yunghegel.salient.engine.InputModule
import org.yunghegel.salient.engine.system.Netgraph

typealias GdxInput = Input

object Input : InputModule() {

    init {
        inputProcessor = this
        Netgraph.add("Multiplexer: ") {
            val sb = StringBuilder()
            sb.append("Multiplexer: ")
            for (i in 0 until processors.size) {
                sb.append(processors[i].javaClass.simpleName)
                if (i < processors.size - 1) {
                    sb.append(", ")
                }
            }
            sb.toString()
        }
    }


    override val registry: Context.() -> Unit = {
        bindSingleton(InputMultiplexer::class, InputAdapter::class) { this }
    }

    private var paused = false

    var tmp : SnapshotArray<InputProcessor> = SnapshotArray()

    object Buttons {
        const val LEFT = 0
        const val RIGHT = 1
        const val MIDDLE = 2
    }

    object Keys {

        
        const val ANY_KEY: Int = -1
        
        const val NUM_0: Int = 7
        
        const val NUM_1: Int = 8
        
        const val NUM_2: Int = 9
        
        const val NUM_3: Int = 10
        
        const val NUM_4: Int = 11
        
        const val NUM_5: Int = 12
        
        const val NUM_6: Int = 13
        
        const val NUM_7: Int = 14
        
        const val NUM_8: Int = 15
        
        const val NUM_9: Int = 16
        
        const val A: Int = 29
        
        const val ALT_LEFT: Int = 57
        
        const val ALT_RIGHT: Int = 58
        
        const val APOSTROPHE: Int = 75
        
        const val AT: Int = 77
        
        const val B: Int = 30
        
        const val BACK: Int = 4
        
        const val BACKSLASH: Int = 73
        
        const val C: Int = 31
        
        const val CALL: Int = 5
        
        const val CAMERA: Int = 27
        
        const val CAPS_LOCK: Int = 115
        
        const val CLEAR: Int = 28
        
        const val COMMA: Int = 55
        
        const val D: Int = 32
        
        const val DEL: Int = 67
        
        const val BACKSPACE: Int = 67
        
        const val FORWARD_DEL: Int = 112
        
        const val DPAD_CENTER: Int = 23
        
        const val DPAD_DOWN: Int = 20
        
        const val DPAD_LEFT: Int = 21
        
        const val DPAD_RIGHT: Int = 22
        
        const val DPAD_UP: Int = 19
        
        const val CENTER: Int = 23
        
        const val DOWN: Int = 20
        
        const val LEFT: Int = 21
        
        const val RIGHT: Int = 22
        
        const val UP: Int = 19
        
        const val E: Int = 33
        
        const val ENDCALL: Int = 6
        
        const val ENTER: Int = 66
        
        const val ENVELOPE: Int = 65
        
        const val EQUALS: Int = 70
        
        const val EXPLORER: Int = 64
        
        const val F: Int = 34
        
        const val FOCUS: Int = 80
        
        const val G: Int = 35
        
        const val GRAVE: Int = 68
        
        const val H: Int = 36
        
        const val HEADSETHOOK: Int = 79
        
        const val HOME: Int = 3
        
        const val I: Int = 37
        
        const val J: Int = 38
        
        const val K: Int = 39
        
        const val L: Int = 40
        
        const val LEFT_BRACKET: Int = 71
        
        const val M: Int = 41
        
        const val MEDIA_FAST_FORWARD: Int = 90
        
        const val MEDIA_NEXT: Int = 87
        
        const val MEDIA_PLAY_PAUSE: Int = 85
        
        const val MEDIA_PREVIOUS: Int = 88
        
        const val MEDIA_REWIND: Int = 89
        
        const val MEDIA_STOP: Int = 86
        
        const val MENU: Int = 82
        
        const val MINUS: Int = 69
        
        const val MUTE: Int = 91
        
        const val N: Int = 42
        
        const val NOTIFICATION: Int = 83
        
        const val NUM: Int = 78
        
        const val O: Int = 43
        
        const val P: Int = 44
        
        const val PAUSE: Int = 121 // aka break
        
        const val PERIOD: Int = 56
        
        const val PLUS: Int = 81
        
        const val POUND: Int = 18
        
        const val POWER: Int = 26
        
        const val PRINT_SCREEN: Int = 120 // aka SYSRQ
        
        const val Q: Int = 45
        
        const val R: Int = 46
        
        const val RIGHT_BRACKET: Int = 72
        
        const val S: Int = 47
        
        const val SCROLL_LOCK: Int = 116
        
        const val SEARCH: Int = 84
        
        const val SEMICOLON: Int = 74
        
        const val SHIFT_LEFT: Int = 59
        
        const val SHIFT_RIGHT: Int = 60
        
        const val SLASH: Int = 76
        
        const val SOFT_LEFT: Int = 1
        
        const val SOFT_RIGHT: Int = 2
        
        const val SPACE: Int = 62
        
        const val STAR: Int = 17
        
        const val SYM: Int = 63 // on MacOS, this is Command (âŒ˜)
        
        const val T: Int = 48
        
        const val TAB: Int = 61
        
        const val U: Int = 49
        
        const val UNKNOWN: Int = 0
        
        const val V: Int = 50
        
        const val VOLUME_DOWN: Int = 25
        
        const val VOLUME_UP: Int = 24
        
        const val W: Int = 51
        
        const val X: Int = 52
        
        const val Y: Int = 53
        
        const val Z: Int = 54
        
        const val META_ALT_LEFT_ON: Int = 16
        
        const val META_ALT_ON: Int = 2
        
        const val META_ALT_RIGHT_ON: Int = 32
        
        const val META_SHIFT_LEFT_ON: Int = 64
        
        const val META_SHIFT_ON: Int = 1
        
        const val META_SHIFT_RIGHT_ON: Int = 128
        
        const val META_SYM_ON: Int = 4
        
        const val CONTROL_LEFT: Int = 129
        
        const val CONTROL_RIGHT: Int = 130
        
        const val ESCAPE: Int = 111
        
        const val END: Int = 123
        
        const val INSERT: Int = 124
        
        const val PAGE_UP: Int = 92
        
        const val PAGE_DOWN: Int = 93
        
        const val PICTSYMBOLS: Int = 94
        
        const val SWITCH_CHARSET: Int = 95
        
        const val BUTTON_CIRCLE: Int = 255
        
        const val BUTTON_A: Int = 96
        
        const val BUTTON_B: Int = 97
        
        const val BUTTON_C: Int = 98
        
        const val BUTTON_X: Int = 99
        
        const val BUTTON_Y: Int = 100
        
        const val BUTTON_Z: Int = 101
        
        const val BUTTON_L1: Int = 102
        
        const val BUTTON_R1: Int = 103
        
        const val BUTTON_L2: Int = 104
        
        const val BUTTON_R2: Int = 105
        
        const val BUTTON_THUMBL: Int = 106
        
        const val BUTTON_THUMBR: Int = 107
        
        const val BUTTON_START: Int = 108
        
        const val BUTTON_SELECT: Int = 109
        
        const val BUTTON_MODE: Int = 110

        
        const val NUMPAD_0: Int = 144
        
        const val NUMPAD_1: Int = 145
        
        const val NUMPAD_2: Int = 146
        
        const val NUMPAD_3: Int = 147
        
        const val NUMPAD_4: Int = 148
        
        const val NUMPAD_5: Int = 149
        
        const val NUMPAD_6: Int = 150
        
        const val NUMPAD_7: Int = 151
        
        const val NUMPAD_8: Int = 152
        
        const val NUMPAD_9: Int = 153

        
        const val NUMPAD_DIVIDE: Int = 154
        
        const val NUMPAD_MULTIPLY: Int = 155
        
        const val NUMPAD_SUBTRACT: Int = 156
        
        const val NUMPAD_ADD: Int = 157
        
        const val NUMPAD_DOT: Int = 158
        
        const val NUMPAD_COMMA: Int = 159
        
        const val NUMPAD_ENTER: Int = 160
        
        const val NUMPAD_EQUALS: Int = 161
        
        const val NUMPAD_LEFT_PAREN: Int = 162
        
        const val NUMPAD_RIGHT_PAREN: Int = 163
        
        const val NUM_LOCK: Int = 143


        // public  final int BACKTICK = 0;
        // public  final int TILDE = 0;
        // public  final int UNDERSCORE = 0;
        // public  final int DOT = 0;
        // public  final int BREAK = 0;
        // public  final int PIPE = 0;
        // public  final int EXCLAMATION = 0;
        // public  final int QUESTIONMARK = 0;
        // ` | VK_BACKTICK
        // ~ | VK_TILDE
        // : | VK_COLON
        // _ | VK_UNDERSCORE
        // . | VK_DOT
        // (break) | VK_BREAK
        // | | VK_PIPE
        // ! | VK_EXCLAMATION
        // ? | VK_QUESTION
        
        const val COLON: Int = 243
        
        const val F1: Int = 131
        
        const val F2: Int = 132
        
        const val F3: Int = 133
        
        const val F4: Int = 134
        
        const val F5: Int = 135
        
        const val F6: Int = 136
        
        const val F7: Int = 137
        
        const val F8: Int = 138
        
        const val F9: Int = 139
        
        const val F10: Int = 140
        
        const val F11: Int = 141
        
        const val F12: Int = 142
        
        const val F13: Int = 183
        
        const val F14: Int = 184
        
        const val F15: Int = 185
        
        const val F16: Int = 186
        
        const val F17: Int = 187
        
        const val F18: Int = 188
        
        const val F19: Int = 189
        
        const val F20: Int = 190
        
        const val F21: Int = 191
        
        const val F22: Int = 192
        
        const val F23: Int = 193
        
        const val F24: Int = 194
    }

    var button = -1
    var key = -1



    fun pauseExcept(vararg processor: InputProcessor) {
        paused = true

        tmp.clear()
        tmp.addAll(processor.toGdxArray())
        tmp.addAll(processors)

        processors.clear()
        processors.addAll(processor.toGdxArray())
    }

    fun resumeExcept(vararg processor: InputProcessor) {
        paused = false

        tmp.clear()
        tmp.addAll(processors)
        tmp.removeAll(processor,true)

        processors.clear()
        processors.addAll(tmp)
    }

    fun pause() {
        paused = true

        tmp.clear()
        tmp.addAll(processors)

        processors.clear()
    }

    fun resume() {
        paused = false

        processors.clear()
        processors.addAll(tmp)
    }

}